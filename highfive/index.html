<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Realtime Space Counter</title>

    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
        }

        body {
            background-image: url("background.jpg"); /* Replace with your landscape image */
            background-size: cover; 
            background-position: center; 
            background-repeat: no-repeat;
            font-family:
                system-ui,
                -apple-system,
                Segoe UI,
                Roboto,
                Arial,
                sans-serif;
            display: flex;
            align-items: flex-start;
            justify-content: flex-end;
        }

        #counter {
            font-size: 96px;
            font-weight: 700;
            color: #000000;
            text-shadow: 0 4px 12px rgba(0, 0, 0, 0.6);
            user-select: none;
            transform: translate(-450px, 400px);
        }

        #remove-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            font-size: 18px;
            font-weight: bold;
            background-color: #ff4c4c;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }

        #remove-btn:hover {
            background-color: #ff1a1a;
        }

        @media (max-width: 1200px) {
            #counter {
                font-size: 64px;
                margin-top: 50px;
                margin-right: 50px;
            }
        }

        /* Offline bar */
        #offline-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: red;
            color: white;
            text-align: center;
            font-weight: bold;
            padding: 10px 0;
            display: none; /* Hidden by default */
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="counter">0</div>
    <button id="remove-btn">Remove 1</button>
    <div id="offline-bar">YOU ARE OFFLINE!</div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import {
            getDatabase,
            ref,
            set,
            get,
            onValue
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCPU33ZcxWoS9NUaDEYJvNcB8FvVtdBTrg",
            authDomain: "notey-4455f.firebaseapp.com",
            databaseURL: "https://notey-4455f-default-rtdb.firebaseio.com",
            projectId: "notey-4455f",
            storageBucket: "notey-4455f.firebasestorage.app",
            messagingSenderId: "554664934050",
            appId: "1:554664934050:web:2e0a56b2dd0823cafa35fb",
            measurementId: "G-L0RJKWNMN7"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const counterRef = ref(db, "counter");
        const counterEl = document.getElementById("counter");
        const offlineBar = document.getElementById("offline-bar");
        const removeBtn = document.getElementById("remove-btn");

        let pendingIncrement = 0; // Store increments while offline
        let pendingDecrement = 0; // Store decrements while offline

        function updateCounterDisplay(value) {
            counterEl.textContent = value;
        }

        async function incrementCounter() {
            try {
                const snapshot = await get(counterRef);
                const current = snapshot.val() ?? 0;
                const newValue = current + 1 + pendingIncrement - pendingDecrement;
                await set(counterRef, newValue);
                pendingIncrement = 0;
                pendingDecrement = 0;
            } catch (err) {
                pendingIncrement++;
            }
        }

        async function decrementCounter() {
            try {
                const snapshot = await get(counterRef);
                const current = snapshot.val() ?? 0;
                const newValue = current - 1 + pendingIncrement - pendingDecrement;
                await set(counterRef, newValue);
                pendingIncrement = 0;
                pendingDecrement = 0;
            } catch (err) {
                pendingDecrement++;
            }
        }

        // Listen for realtime updates
        onValue(counterRef, (snapshot) => {
            const value = snapshot.val() ?? 0;
            updateCounterDisplay(value + pendingIncrement - pendingDecrement);
        });

        // Space bar increments counter
        document.addEventListener("keydown", (e) => {
            if (e.code === "Space") {
                e.preventDefault();
                incrementCounter();
            }
        });

        // Remove button decrements counter
        removeBtn.addEventListener("click", () => {
            decrementCounter();
        });

        // Detect online/offline
        function updateOnlineStatus() {
            if (navigator.onLine) {
                offlineBar.style.display = "none";
                if (pendingIncrement > 0 || pendingDecrement > 0) {
                    incrementCounter(); // Sync pending increments and decrements
                }
            } else {
                offlineBar.style.display = "block";
            }
        }

        window.addEventListener("online", updateOnlineStatus);
        window.addEventListener("offline", updateOnlineStatus);

        // Initial check
        updateOnlineStatus();
    </script>
</body>
</html>
